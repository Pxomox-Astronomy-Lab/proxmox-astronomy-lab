### **Unified Worklog: Enterprise Infrastructure Maturation Initiative**

* **Date Range:** Saturday, July 27, 2025 â€“ Sunday, July 28, 2025
* **Engineer:** vintagedon
* **Project:** Proxmox Astronomy Lab (P/AL) - Enterprise Upgrade

## 1. Summary

This initiative successfully designed and deployed a multi-layered, defense-in-depth security architecture for the P/AL infrastructure. The work focused on establishing a Zero Trust access model, implementing a hybrid identity and access management (IAM) framework, enforcing a secure configuration baseline across all server assets, and deploying a comprehensive security operations and monitoring platform. The resulting architecture establishes clear, auditable security boundaries and systematically addresses numerous controls across the CIS and NIST frameworks, with a continuous verification capability now in place.

## 2. Key Workstreams and Accomplishments

### Workstream 1: Hybrid IAM & Cloud Access Control Framework

* **Goal:** To establish a cohesive identity framework across on-premises Active Directory and Azure AD, based on a tiered, least-privilege operational model.
* **Actions Performed:**
    1. **Tiered Model Definition:** A three-tiered (L1 HelpDesk, L2 Operations, L3 Engineering) operational support model was formally designed to serve as the logical basis for all access control policies.
    2. **Dual-Authorization Group Structure:**
        * **On-Premises (`SGAD_*`):** Scripted the creation of **41 standardized Active Directory security groups** to manage access to on-premises and hybrid resources.
        * **Cloud (`SGC_*`):** Created a parallel set of **6 role-assignable security groups** in Azure AD, designed for assigning permissions to Entra ID and Azure resources.
    3. **Custom Azure RBAC Development:** Designed and implemented **6 custom Azure RBAC roles** (e.g., *Platform Triage Operator*, *Platform Engineer*) with granular permissions tailored to the responsibilities of each support tier.
    4. **Hybrid Identity Sync:** Configured Azure AD Connect to synchronize the on-premises user and group structure to the cloud, enabling a single identity source for authentication and authorization.

* **Strategic Impact:** This dual-authorization system establishes a comprehensive IAM control plane, allowing for precise, auditable, and role-based access control across the entire technology stack.

### Workstream 2: Zero Trust Network Access (ZTNA) Architecture

* **Goal:** To establish a secure, MFA-enforced remote access security boundary for all infrastructure assets, including administrative protocols.
* **Actions Performed:**
    1. **Secure Perimeter:** Deployed Cloudflare Tunnel as the **sole remote access vector** for the entire on-premises cluster. This ensures no inbound ports are exposed on the perimeter firewall, effectively eliminating a primary attack surface.
    2. **Identity Provider Integration:** Configured SAML authentication and SCIM provisioning between Cloudflare and Azure AD.
    3. **Application & Policy Definition:** Defined all internal services and servers as distinct applications within Cloudflare Access. Created granular access policies that map access rights to the synced `SGAD_ZTNA_*` security groups. This includes control over administrative protocols like SSH, where access is now governed by ephemeral, identity-based credentials tied to a user's Azure AD session.
    4. **MFA Enforcement:** The integration with Azure AD Conditional Access enforces strong MFA (YubiKey/Passwordless for privileged accounts) for all remote access attempts before a user's traffic can reach any internal resource.

* **Strategic Impact:** This workstream established the primary security boundary for the infrastructure. All remote access is now explicitly identity-based, centrally managed, and rigorously audited through a single control point.

### Workstream 3: Automated Secure Configuration Baseline (GPO-as-Code)

* **Goal:** To apply a consistent, auditable, and verifiable CIS Level 1 security baseline to all Windows Server assets.
* **Actions Performed:**
    1. **Control Derivation from Tenable:** The required CIS controls were systematically derived from Tenable audit files to ensure the implemented baseline directly maps to the compliance validation tooling.
    2. **Policy-as-Code Implementation:** Over 115 security settings were codified into a master CSV file, establishing a version-controllable source of truth.
    3. **Automated Deployment:** An idempotent PowerShell script deployed the entire baseline, creating **47 distinct Group Policy Objects** in under 30 seconds.
    4. Deployed GPOs: The following GPOs were created, grouped by their primary CISv8 control:
  * CIS04 (Secure Configuration): 16 GPOs covering App Installer, App Runtime, Autoplay, Cloud Content, Credential UI, Data Collection, Device Installation, Early Launch AM, File Explorer, Group Policy, Kernel DMA, LSA, Logon settings, and MS Security Guide policies.
  * CIS05 (Account Management): 3 GPOs for Account Settings and SAM RPC restrictions for DCs and Servers.
  * CIS06 (Access Control): 4 GPOs managing Anonymous access restrictions and credential delegation.
  * CIS08 (Audit Log Management): 2 GPOs for configuring Time Synchronization settings.
  * CIS12 (Network Infrastructure): 11 GPOs hardening DNS Client, UNC paths, IP Settings, Lanman Server/Workstation, *NetBT, Network Connections, SMBv1, WinRM, and Connection Manager.

* **Strategic Impact:** This workstream ensures all Windows Servers maintain a consistent, hardened security posture that is verifiably compliant with the CIS benchmark.

### Workstream 4: Security Operations & Continuous Monitoring Deployment

* **Goal:** To deploy a security information and event management (SIEM) platform to establish continuous monitoring and compliance verification across all server assets.
* **Actions Performed:**
    1. **Agent Deployment:** Successfully deployed and activated **18 Wazuh agents** across the entire server infrastructure, including domain controllers and all 17 primary Linux/Windows project and management servers.
    2. **Platform Activation:** Established a centralized Wazuh server for log aggregation, security analytics, and event correlation.
    3. **Module Configuration:** Activated key security modules, including Security Configuration Assessment (SCA), vulnerability detection, and File Integrity Monitoring (FIM).

* **Strategic Impact:** This deployment provides a foundational Security Operations capability. It enables continuous monitoring of the infrastructure's security posture, provides an evidence-based mechanism for compliance validation, and offers real-time threat detection and analysis.

## 4. Consolidated Security Posture Baseline

The weekend's initiatives established a multi-layered, enterprise-grade security posture, validated by the newly deployed monitoring platform.

* **Perimeter & Access Control:** The infrastructure is physically secured and logically isolated, with the Cloudflare ZTNA tunnel providing the sole, MFA-gated remote access path.
* **System Hardening:** All assets operate from a secure baseline. Windows Servers are CIS Level 1 compliant via GPO, and Linux servers are built from a CIS Level 2 hardened Ubuntu 24.04 template.
* **Quantitative Compliance Baseline:** Initial Wazuh SCA scans against the CIS benchmarks provide a quantitative starting point for ongoing hardening. For example, the `mgmt-agents01` host, a development server, currently shows a **52% pass rate (142 passed, 128 failed)** against the CIS Ubuntu 24.04 LTS Benchmark with most issues related to detection of the fix. This provides a clear, actionable list for targeted remediation.
* **Continuous Vulnerability Detection:** The Wazuh platform is actively identifying potential vulnerabilities, with initial scans on development hosts providing a baseline for creating a systematic patch and remediation strategy.

## 5. Overall Outcome & Next Steps

This initiative successfully implemented the foundational identity, access, and security-policy control planes. With a verifiable security baseline and continuous monitoring now in place, the immediate focus shifts to applying these new controls at the application layer and remediating initial security findings.

### **Immediate Priorities**

1. **Implement Role-Based Access Control (RBAC) Across the Application Stack:**
    * **Objective:** Apply the new, granular IAM framework to all internal services to enforce the defined security boundaries at the application layer.
    * **Scope:** Integrate OIDC/SAML with Azure AD for services such as Gitea, Kubernetes, Proxmox VE, PostgreSQL, and other management UIs.
2. **Remediate Baseline Security Findings:**
    * **Objective:** Use the initial Wazuh SCA and vulnerability scan data to create and execute a remediation plan.
    * **Scope:** Prioritize and address the failed CIS controls and critical/high vulnerabilities, starting with the baseline Linux and Windows images to ensure all future deployments are improved.
3. **Address Documentation and Knowledge Management Debt:**
    * **Objective:** Formally document all new architectures, configurations, and operational procedures to ensure long-term maintainability, auditability, and team readiness.
