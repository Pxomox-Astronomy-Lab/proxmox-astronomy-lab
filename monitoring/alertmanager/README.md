<!-- ---
title: "AlertManager - Proxmox Astronomy Lab"
description: "Documentation for AlertManager, including alerting structure, notification flow, and integration status."
author: "VintageDon"
tags: ["alertmanager", "monitoring", "alerting", "notifications"]
category: "Services"
kb_type: "Service Document"
version: "1.0"
status: "Draft"
last_updated: "2025-03-09"
---
 -->

# **AlertManager - Notification & Alerting System**

## **1. Overview**

### **1.1 Purpose**

AlertManager is responsible for **handling alerts generated by Prometheus** and routing them to appropriate **notification channels**. It ensures **critical infrastructure issues** are detected and escalated in a timely manner.

### **1.2 Current Alerting Implementation**

- **Alerts are currently email-based.**
- **Teams integration (Adaptive Cards via Power Automate) is tested & validated** but not yet fully implemented.
- **Basic health checks are enabled** (e.g., service uptime, CPU usage, and disk space monitoring).
- **No advanced correlation or anomaly detection** (future work planned).

### **1.3 Scope**

| **In Scope** | **Out of Scope** |
|-------------|------------------|
| Basic health monitoring | AI-driven alert correlation (future) |
| Email-based notifications | SMS/PagerDuty integrations (not planned) |
| Teams integration (validated) | Multi-region alerting (not needed) |

---

## **2. Alerting Categories & Notification Flow**

### **2.1 Alert Categories**

Alerts are grouped into **logical categories** based on system impact and priority:

| **Category** | **Examples** | **Severity** | **Notification Method** |
|-------------|-------------|------------|------------------|
| **Infrastructure Health** | Node down, VM offline | Critical | Email, Teams (Planned) |
| **Service Availability** | Web UI down, API unreachable | High | Email, Teams (Planned) |
| **System Performance** | High CPU, disk full | Medium | Email |
| **Security Events** | Multiple failed logins, banned IPs | High | Email, SIEM (Planned) |
| **Networking Issues** | High latency, SNMP device offline | Medium | Email |

### **2.2 Alert Notification Flow**

1. **Prometheus detects an issue** and generates an alert.
2. **AlertManager evaluates severity** and routes it accordingly.
3. **Email notification is sent** to administrators.
4. *(Future)* **Teams Adaptive Cards trigger structured triage.**
5. *(Future)* **Escalation workflows activate for critical issues.**

---

## **3. Summary of Alerts by Machine Type**

### **3.1 Proxmox Nodes & VM Infrastructure**

| **Alert Type** | **Trigger Condition** | **Notification** |
|--------------|-----------------|-----------------|
| Node Down | No response for 5 min | Critical (Email) |
| High CPU Usage | >90% sustained for 30 min | Medium (Email) |
| Disk Full | <5% free space remaining | High (Email) |

### **3.2 Kubernetes Nodes & Containers**

| **Alert Type** | **Trigger Condition** | **Notification** |
|--------------|-----------------|-----------------|
| K8s Node Not Ready | Node unresponsive | Critical (Email) |
| Pod Restart Loops | >5 restarts in 10 min | Medium (Email) |
| High Container Memory | >85% memory usage | Medium (Email) |

### **3.3 Applications & Services**

| **Alert Type** | **Service** | **Trigger Condition** | **Notification** |
|--------------|----------|-----------------|-----------------|
| Web UI Unavailable | Grafana, Portainer | HTTP check fails | High (Email) |
| Database Query Latency | PostgreSQL | Query time > 2s | Medium (Email) |
| API Failure | Nextcloud, Vault | Endpoint unreachable | High (Email) |

### **3.4 Network & Security Monitoring**

| **Alert Type** | **Trigger Condition** | **Notification** |
|--------------|-----------------|-----------------|
| High Latency | Response time > 500ms | Medium (Email) |
| SNMP Device Down | No response for 5 min | High (Email) |
| Multiple Failed Logins | >10 failures in 5 min | High (Email) |
| Fail2Ban IP Ban | IP banned due to brute-force | Medium (Email) |

---

## **4. Teams Integration (Planned)**

### **4.1 Power Automate Workflow**

- **Adaptive Cards** will replace email for structured notifications.
- **Acknowledge, Resolve, and Escalate buttons** allow instant response.
- **Integrated with Teams channels** for better triage.

### **4.2 Teams Notification Channels**  

Alert notifications will be routed to **Microsoft Teams** channels for **structured triage and response**. The Teams structure is designed to categorize alerts based on their impact and relevance to specific infrastructure components.  

📌 **Reference Screenshot:**  
![teams-monitoring-screenshot](/assets/images/teams-monitoring-screenshot.png)  

| **Channel** | **Purpose** |  
|------------|------------|  
| **General** | General announcements and monitoring discussions. |  
| **Apps** | Alerts related to applications and services (e.g., Nextcloud, Vault, Gitea). |  
| **Cluster** | Alerts from the **Proxmox cluster** and **Kubernetes nodes**. |  
| **Logs** | Log-related alerts and aggregation from **Loki**. |  
| **Misc** | Catch-all for alerts that do not fit into other categories. |  
| **Pipelines** | CI/CD and automation pipeline alerts. |  
| **Security** | Security-related alerts, including authentication failures and SIEM notifications. |  
| **VMs** | Alerts for individual virtual machines and instances. |  

Each **Teams channel** will receive **alerts via Adaptive Cards** using **Power Automate**, allowing users to **acknowledge, resolve, or escalate incidents directly from Teams**. 🚀

---

## **5. Next Steps**

✅ **Basic alerting fully configured.**  
✅ **Teams integration tested & validated.**  
📌 **Next: Implement Teams notifications & structured response.**  
📌 **Future Enhancements: AI-driven alert correlation & escalation workflows.**  

---

## **✅ Approval & Review**

| **Reviewer** | **Role** | **Approval Date** | **Status** |
|-------------|---------|------------------|------------|
| VintageDon | Lead Engineer | 2025-03-09 | ⏳ In Progress |

---

## **📜 Change Log**

| **Version** | **Date** | **Changes** | **Author** |
|------------|---------|-------------|------------|
| 1.0 | 2025-03-09 | Initial documentation | VintageDon |

